/*
 * IndependenceSampler.cpp
 *
 *  Created on: Aug 6, 2012
 *      Author: trevorshaddox
 */

#include <iostream>
#include <fstream>
#include <sstream>
#include <cmath>
#include <cstdlib>
#include <cstring>
#include <map>
#include <ctime>
#include <set>

#include <math.h>

#include "IndependenceSampler.h"
#include <Eigen/Dense>
#include <Eigen/Cholesky>
#include <Eigen/Core>



#define PI	3.14159265358979323851280895940618620443274267017841339111328125

//#define Debug_TRS

namespace bsccs {

IndependenceSampler::IndependenceSampler(CyclicCoordinateDescent & ccd) {
	MHstep.initialize(ccd);
}


IndependenceSampler::~IndependenceSampler() {

}

double IndependenceSampler::getTransformedTuningValue(double tuningParameter){
	return exp(-tuningParameter);
}
void IndependenceSampler::sample(Model& model, double tuningParameter, boost::mt19937& rng) {
	cout << "IndependenceSampler::sample" << endl;

	model.BetaStore();
	Parameter & Beta = model.getBeta();
	Parameter & Beta_Hat = model.getBeta_Hat();
	Eigen::LLT<Eigen::MatrixXf> choleskyEigen = model.getCholeskyLLT();

	//bsccs::real test[] = {0.0346014539191722,1.49581331664186,0.301193809759863,0.118914224463973,-0.147387447518103,-0.282424150427801,0.159791995327395,-0.0342216641697469,-0.0214336185670071,-0.174109724133682,0.0501098666834342,0.211445699868159,0.0590051985299334,-0.132203233021845,-0.0569209131319486,0.0357727653059002,-0.101587124043211,-0.077432449994965,0.104376117116115,7.49396391681173e-06,-0.917428778387827,2.08543253228849,2.11316057610815,-0.176971984824036,0.149054170498237,-0.0172815580647603,-0.00422059710846601,-0.164899556365669,0.170773149307844,-0.135062698336218,-0.0256544094802642,-0.370463216948477,0.320410650815578,-0.20991350634166,-0.0199975021315748,-0.153601651338118,-0.122621925393649,-0.0781383295593979,0.0493185125878343,0.0451059527833507,-0.0218310029938727,0.111174060883646,0.732996436884094,-0.298638680918478,-0.0881177466095673,0.120202790344763,0.0932516923088078,0.119287880059133,-0.127221915116417,-0.145909463037092,0.339182094381425,-0.0248171987032001,-0.00631974774770718,-0.00200217289989481,-0.00567876183600433,-0.0312262988014545,-2.86727563927231,0.0302162636297447,1.43158652137702,-0.00528209240973988,-0.0242598131813839,0.0227271458548011,0.185452708515164,4.1316564692418,-0.847750944559893,0.00933695225163431,-0.663761626458002,-0.670750356944256,-0.0115607659391438,-0.0195265813766709,0.00115901487328738,0.610710268562608,0.0604413837062,0.0366405823704166,2.03123051027079,-0.582261745681359,0.745353052066332,1.2855401896131,2.50159953318346,0.192682533050982,0.808741028619284,-0.479345026254078,-29.8105263012088,-0.201918500189003,-0.650610229785762,-0.817222467589513,0.0484937795756734,0.218554384744044,0.00798566200876487,0.0775024457273722,-0.105257804495663,-0.246823454774186,1.11213395263825,3.92169681376829,0.0644093422821032,-0.230848805848253,0.273480354477603,0.534842589871198,2.4669748404187,-0.00771551998689129,0.744613730857201,0.647167721766628,0.420775258091772,0.230752215724219,4.29764874599019,0.0829262486610636,0.00976806441328818,3.56236583200327,3.59937128439559,-2.00136802121684,-0.0652083845867187,-0.0114442215043706,0.0705843561901212,0.873482818748029,-0.186543758496562,-1.38271813046549,3.47081828118039,-0.472275045184117,0.302182482405418,12.5966746347118,0.0178521214353655,0.275161338074355,0.0254044568418252,-0.511704217105532,0.00863484528887064,0.0593480300460089,-1.15757564957275,-3.94712036868666,0.0155880073985144,-0.689944523554873,-0.110846541200004,-0.775579446216181,-0.0796064403628032,2.04011432939582,0.523923863570648,0.638360766590143,0.0137312956108671,1.78266976615784,0.0670016404713886,-0.842699304528016,-1.03851870149045,-5.43911227261033,0.339514739346532,0.136066584512347,-8.42271675776532,-0.395333982905549,2.6359374498279,0.667083620167322,-6.51258603524411,-0.309282960207683,0.66447555770422,0.131179741980598,0.764206147407756,0.442267052685755,-1.28310224184794,-0.00591499978305267,1.27153897121253,0.0663435611869466,-0.502860333803934,0.418392463381899,-0.161716502921411,0.520031507557872,1.2966206879523,-0.198940572419301,-0.739626711096673,-0.0148806958332675,-2.33408699522262,-0.00737541914768383,0.00357470098682171,0.0232989598030749,0.282183087069748,0.330196688750196,-0.444381360776159,0.256809736760199,0.169107734794796,0.223128923557258,0.00602190262037233,-2.79724959025296,-16.6798352731334,-0.087528950255266,-0.592861634305228,0.720617002497557,0.135919830928565,0.670988024506055,-0.538795978841037,-0.143481645432819,0.411163662486561,0.259079764428427,-1.46211009903277,-0.644906661362575,1.51605579109221,2.9632393533135,-0.207865787787215,-0.0108310836193872,0.381031611753438,0.002901904999652,0.95513604570635,-0.114541544547903,3.32782305381958,1.27011860747686,-4.60670955718902,0.00560544817786727,0.443580611110171,2.08216141968104,-0.0193420509148763,0.380390835268381,0.337322834409788,-0.0711516454413055,0.866625587499833,-0.365997124632526,0.149374400203783,0.00533683446921982,0.392322058451376,-0.02119971102459,1.9775080353303,-0.163301155388142,0.00487343209703155,-0.027093418851054,-0.00677076707504095,-0.279866857619048,2.74507743268875,3.10514413229759,0.00538012566064296,-10.7374444787668,2.27059577955485,-0.0138411863057626,-1.28682231018131,0.280448838016906,57.3707348876338,1.73326988105151,-1.2765884918282,0.178088292661588,0.658546097404216,0.0367499927713646,14.1917311705079,0.153803832237508,-0.123611552574622,-0.000587386694921572,0.373576982669506,-0.145967035886549,-0.0124964648913074,-0.732446188371665,-0.00930477308692844,-92.952069992905,0.276692981880465,0.0724283395154856,-4.08625597239984,-0.169488615627106,0.0389046840100425,-0.89460355659496,-0.152315731327644,-0.0218258035783833,-0.0310549065607779,9.48281719523183,-0.498831208146903,-0.0314167057829583,0.289260478679755,-0.769322515434211,0.715883996335154,-0.112731159972356,-0.00815109230963578,-0.0180688668259382,0.00433784644398363,-0.00134736709299503,-0.109713103828376,1.45824884904513,3.73406858905519,0.0368222243650018,1.2118737227463,-0.0122818743931865,0.305720866811201,8.78267074240554,-146.045984503048,8.19115934945025,2.89723429630192,-0.365711685564363,0.465937729644867,-0.0172594979869321,-0.187906172636731,-0.140966392404291,0.240436233476406,0.153855831216534,2.34528449547358,6.2322013095549,-12.1789861138805,0.372307643764003,-0.229008611168856,9.56876424607496,-0.0224560905828864,0.00869565322331704,-1.60752931585078,61.2737318884925,0.00625493486694885,0.00921936479680285,-0.299362099107668,-0.189021118335764,-0.0287716821062449,4.13703271696261,0.786892136824831,0.0521894839237564,0.00989544323850752,-0.00952324407957159,-0.0252879052981866,0.215458469318523,-0.00106478697415131,0.831411699448766,0.160676134954586,-0.518539788880025,-0.18627982208774,-0.252090117448355,0.21088928674741,0.67358366087388,-0.0721325610889563,0.00397690770021328,-0.18751666342101,0.340809342705124,-0.0018215144747338,-0.0100522479487679,-0.075416807279362,-0.00807364002483023,0.577946492884244,-0.00521969201554109,0.564697352593705,-0.00801954530459125,0.139274734774447,0.174819775133457,0.57843156483597,0.37368772615052,0.357916774114525,0.00678619441245128,-0.00491412255339151,0.36217735029956,0.490016476793869,0.556688179717058,-0.0840448460435834,-0.0871327949737103,-0.509757864225384,0.0662382271627058,-0.000978671885315867,-0.649934136797362,-1.27532082589139,-0.0263882403150674,-0.870371069309147,1.2428940815208,0.112356876868303,0.492179151600763,-0.593233759409566,0.0139008474220248,-0.0479058739500627,-0.504703668604705,0.297906917720341,-0.0691431160502456,-0.231757230239942,2.12088938073323,0.0259775053540424,3.6114656432797,0.00593712656642511,0.0562731764857156,0.363687095127202,0.00623733421747815,-0.0837434656176475,-0.0342222812542931,0.482522022999126,-0.00902484142335631,0.0142552512127782,-0.00568460388845545,-0.208664215408788,0.00508951055705863,-0.371551958367493,-0.0179779416634577,0.118040949727695,0.00776327123717873,0.0352881871975644,0.0200757420391422,0.575083350646731,0.0283059322051192,0.0277123652095495,-0.00197176693608718,0.338376818271661,-0.00189795254204474,-0.0267909676444494,0.116905547765032,-0.381154116953423,0.00284576392152415,-0.0039678450134251,0.114610844470698,-0.0979155662619752,0.395442405708706,0.238055907061845,0.0708995491307427,-0.0396490983040601,-0.0815727287956008,-0.0077591742110662,-0.0270588217884264,0.282143453670203,0.146537096154038,0.318875498885637,-0.00249701445904756,0.42527990306886,0.0716769557369688,0.550292041787381,0.695465758968272,0.318644963099213,-0.0242048559683465,-0.00870426770206974,0.123555844303331,0.132205492420855,-0.00725140849948742,0.778312833252706,0.0179424470237416,-0.00321708761743639,0.0211522573553334,-0.0891772931470514,-0.0496719696689665,-0.0129328890587749,-0.0573043087935373,0.00592333706713528,-0.0168958464186002,-0.000661915949431937,0.118883292178511,0.395875028801342,0.0115511912141791,0.00238698211511498,-0.00403433386270153,0.0845975058874606,0.158246725797219,0.138245327821819,-0.981443837262317,3.0741236321108,0.359318327017018,0.0197834874463501,0.0750556050716547,0.417864030994351,0.0151815811629654,0.0399624811157381,0.308979462658574,0.440472123769569,-0.0239333891313418,0.0097584950467402,-0.0094372809260358,0.699512656953795,1.02333169209533,0.0988138342792576,0.367169039526104,-0.0540416215873809,-0.00335200500349865,0.131613998842499,0.0404030838686844,0.227308733633139,-0.00497348769130906,0.0024852686374846,-0.00846616152446984,0.431883817958391,0.668848780478711,0.519587516765859,-0.14159762746064,0.316548179934867,0.00291454666234238,-0.131328074184878,-0.760203715669114,0.468607159070824,0.00193996588640921,0.138006683102101,0.547209072033614,0.00901721756713527,0.199943842257895,0.253407322065109,-0.0291944197955097,0.278965936884074,-0.0394143275431319,0.827498417641435,-0.00532282858789562,0.201095576600293,-6.33588035720868e-06,-0.183114880382524,0.000440533540864604,0.0239669304679849,0.259536016044195,0.323065221981957,-0.00347788103896014,0.120713263376296,-0.0428771786672478,0.052480968864122,0.123468596347083,0.0113461668866109,-0.0208883417288773,0.0173605538144381,1.44685804129743,0.274002614570553,0.0121502391196436,-0.0105340060268078,0.160907339730969,0.704778535603039,-1.55116471923043,0.387324624002099,0.0933892518490471,-3.02186360367384,-0.447486782434773,0.279937648310572,-0.30846488399683,-0.00867731362475181,-0.152970484218137,-0.00926772467282351,0.00893103515440067,0.156439063602694,-0.451159272421523,-0.00515726689531155,0.0600888746021324,-0.00455068303350601,12.2756624042253,0.014297413105398,0.33356907789388,-0.226233224116735,0.460753979491593,0.0862739102657157,0.0927597756151217,0.370346108830052,0.379969780763239,0.320106470962676,0.252639413824757,12.9899845364013,0.439760185429528,0.0100587982676171,0.00254157359199297,0.672707178366208,0.377148490971979,0.547098085186544,2.18572957977961,0.112850332753682,-0.0134359557201278,0.09990522598104,0.509679125381836,0.189527972444747,0.611689471957936,-0.0129419207480153,0.267494581328781,-0.00297128432259916,0.625205766692599,0.00514074963441694,0.494266392237027,0.35757365596303,0.22034406976487,0.0263408503864568,0.864067615853749,0.4546845603762,0.184744144282311,0.799000575741508,-0.113504708037949,0.769455960452566,-0.158976016129853,0.356018896448395,0.365609942050808,0.424461899300941,-0.0610785461638803,-0.063999537034255,-0.0302786902664642,0.341105185354489,0.00459848925547911,0.279856048391992,0.2670142349096,0.0977631567496327,0.796062201512346,0.215679036866389,1.01774061094991,0.020131835437892,0.409159617215891,0.0702878586519943,-8.67731068608643,-0.0447689285898724,-1.39702809528333,1.04291387565292,0.00710347555904539,0.506005558521444,0.0121815320823631,-0.0440104109152288,-0.0383298958915238,0.424983577589702,-0.00847629828253825,-0.0736089151296477,0.00547877288183827,-2.267970087456,0.582209322820446,-0.0831091309624513,0.00760624107111954,0.142766109086794,0.488078816646607,-0.0522067603751204,0.446793635747031,0.560108391789962,0.762514602175515,0.270469417544768,0.100344948955914,0.447822783313167,-0.0157248771741286,-0.0118465954992032,-4.53615326786114,0.43157906190836,0.16894865783321,15.6733491457834,0.304165184114845,0.421690201663537,0.684719049127004,0.191574637961518,0.22082073632098,0.118592466789895,3.15477447874135,0.00250411290552531,-0.0154909781598337,0.0328091161555346,0.0201487868548501,0.860296489999028,-0.0274666811322346,0.0142000381108649,0.288820159674803,0.251567317897852,0.639102796574402,0.0321786909926225,-0.00426862283307238,0.315562899827134,0.0854835034445646,0.152884506578695,-0.025374633897316,-0.00633318358193981,-0.0616576653542076,0.243576603147255,-0.365319561658119,0.91716808900233,0.345132970385614,0.471631100537772,-0.0163789913136251,0.110011371034589,0.185445203605358,0.114740259412523,0.605798088879644,0.0162926763233783,0.177565428921958,0.0169911076186259,0.0833671019535532,-0.0203664331381113,0.145032187215856,0.377282990050177,-0.0227637529874432,0.371023813574206,-0.0284491628862564,0.138509832048415,0.134773218959919,-0.00746115498791788,0.663126079993521,-0.0147148029636296,0.019446218175251,0.0293471209573533,0.173880750571665,-0.0132580770162128,0.543099554003884,0.20129277751589,-0.0154234454366621,0.613498579655506,-0.181273054762374,-0.0120307192998512,-0.0512376965244922,1.10768848128101,0.19853884627029,0.776955400404719,1.11261674365744,0.00450806083920217,0.24464889448483,-0.0557998490323441,0.00392024925497968,0.191118728433913,1.17746095401987,0.323468456776126,0.00290598786980906,-0.170745656639225,0.0517231710176538,0.0163981196529479,0.23377961525102,0.6284832747686,0.927252325417789,0.111850162673793,0.342609143321262,0.617228521320153,-0.100068379393648,0.275853037690012,0.0100449507218299,-0.00826729480249894,-0.00119192822948552,1.06835383059546,0.410942391991251,0.999632311766609,0.176351035630075,-0.00135085424910982,0.0537027377691373,0.000511774360681657,0.558541513146077,-1.02094343975654,0.0114050416645127,0.4137137141574,0.459399715715422,0.0525306916043169,0.677122471947766,0.190885241476784,0.0260766251723005,0.0542982953115368,-0.00245120047857423,1.0429251828061,0.00279738669308695,0.0171422939922049,0.0108308353062096,0.00142609366329687,0.258283300226207,0.231783108310011,0.102758576879538,0.0595669356349084,1.17596589474233,0.0091786175168511,0.195639472548968,0.19335333275919,0.304616770342675,-0.00309785722115649,0.95921427191923,0.00480378961124942,0.0937246953139271,-0.00221801405659157,-0.0240216671596725,0.904342659719378,0.0705272276479979,0.696888048641244,0.316016250064568,1.51530661509286,1.22898134266883,0.0300926434443671,0.00166920039641221,0.906650400610923,-0.004818061304554,1.03515836179087,0.011108130271144,0.0889766305924688,-0.00832086272707588,-0.044195848551309,0.374723615560068,-0.0108674392734938,0.167965085186435,0.0131376609235263,0.0968201324750625,0.898670037937519,-0.0260136387109601,0.684615097039347,0.011715655859237,1.49933882332039,0.269253597808821,0.117368199202298,0.478665967199097,0.826263198390002,-0.00520523985891912,0.487433435012851,0.0484401335270806,0.00447180468842629,-0.0180527583213321,-0.00896013431253295,0.205049542684721,-0.220778784107568,0.134637634987808,0.0872724366710339,0.0761653214912185,-0.0241450921011057,0.0132652247094435,0.164967186115744,0.15306793647851,1.13113837154058,0.880534004639177,0.686873497073797,0.690060870736053,0.227547683581767,3.19974629077011,-0.0239991540328985,0.436328892740923,0.00226538695652428,-0.0472341804647991,0.00217834469886616,0.013641627490848,0.0202550667178983,0.674569170568921,-0.00887401496566772,0.00626800541255858,-0.0170528776341748,0.00669131236353634,0.0239126190734609,0.17954203297947,0.31620851440375,0.51006398533335,0.411065909978886,0.0195247827899283,0.0324899655142638,0.512121026075086,-0.00208507016839538,0.00561442861967895,-0.000867991072150319,-0.0312132945876316,0.220191230303979,0.173596136075651,0.0234467927919201,0.114054009930721,0.588445215126412,0.0870987343602164,0.3624396839323,-0.00555756406148159,0.0494527301363182,0.00677258164194074,0.00987704863069494,1.02809856705823,0.333628060032656,-0.000604373936519522,-0.0193478948526183,-0.00681992081413765,0.647304934449886,0.267920469320886,0.380727306822032,0.37459672422335,0.228574958741589,0.155905741748163,-0.0311170286698835,-0.0173649773111348,-0.000854262475259447,0.0793544916338103,-0.0158368388906916,0.0491939385687674,-0.0122164309699109,-0.00691329813699064,0.635090740006584,0.243959248737149,0.000972756806167159,0.0324483284799971,0.565898436489047,0.20822750741522,0.665287119786558,0.28866676741589,0.00267944525482433,0.00418267823828634,0.00783927206753332,-0.0107975934993297,-0.00288411458440208,0.599544527300004,0.117835620248674,0.197211430560996,0.0387183790507948,0.302385197970413,0.237376875920273,-0.12511551475476,0.165784196291651,0.572999369811219,0.0464662255830089,-0.000209027433297842,0.240551900873022,0.601738966065279,0.0150578370530755,0.72669188685524,0.790847008652261,0.678087094414063,1.60746462948532,0.00011224881585313,0.114900303696843,-0.00736596119123647,0.00289694392424698,0.750829902627851,0.0263341705584268,1.02653247861773,-0.0166133440399015,-0.0263862664585707,0.314010888656347,0.322360230351956,0.019535187539354,0.334949567572191,-0.000446535427283831,-0.0234364681031296,0.13352225791093,0.942940446986819,0.0203727325732121,0.110125932733461,0.204276437272924,0.679168277992006,0.75411452335142,0.639594927456474,-3.15002748140986,0.373873668749322,-0.0211157003939725,0.000169137444109484,0.00411232887774323,0.426574793492877,0.266678098182121,0.702268179212051,0.32164527874965,0.269885725271808,0.250628897725953,0.698457678762388,0.206106438344293,0.34988393347817,0.188487730612355,0.203838076939247,0.387028680975427,0.519284324982202,0.289561230502442,0.292811615978527,0.0879317225178953,-0.00191194848702214,0.280505501579225,0.0843396572390321,0.888756909745521,0.200233416735668,-0.00458575959938852,-0.000497555717746462,1.15148892141949,0.175200228876862,0.349216561337757,0.00133998629788202,0.25633578674324,1.16493006318901,0.007955473265733,0.0014540372381361,-0.0206284208203449,0.0162453014274852,0.174101102958758,0.737782206174983,0.978300560560637,0.092516423665664,1.01497312156935,0.907760338436215,-0.00319126482721747,0.75223479028477,0.708736758490921,0.633705664164374,0.144121824998789,0.279977330293856,0.282101200932163,0.994202160017876,0.911967920284261,0.332771576876762,-0.00224575672171628,0.0607551731519619,0.00616689989422503,0.245091423561353,-0.018613931136106,0.803606287143221,0.643008085466792,0.10585959821977,0.749942495649036,0.829521296569031,1.49351489292384,0.667455315223601,0.100190981058463,0.0297710263908569,0.00987782608710266,0.548071012801744,0.75999657234794,0.667826298467703,0.717279292214969,0.0264572599552457,0.0309707052962426,-0.0526225953930268,0.232590734238527,0.331163422642848,0.0165819625687462,0.0199510205330075,0.777799579217529,-0.0199417774120633,0.947986826934713,0.0231106332368263,0.149264052772123,0.53145075222227,0.297717831356031,0.557861403174603,0.41343153559249,-0.0142323176928588,0.770711364444379,-0.00947545470101148,0.586804580293743,0.0220682789305993,-0.0152057780989545,0.00902117008907162,-0.0270244354469651,-0.889290134244658,0.0813769066761846,0.463162451795133,-0.0492655305723419,-0.000992417704507129,0.202729817612716,-0.012780894643009,0.509388196316349,0.261969582959209,0.0400081388606603,-0.0555174177981143,-0.00936706370501082,-0.0129435681390225,0.267172818904503,-0.0157138081189961,0.589467577014846,-0.0062560090407581,0.331382550442947,0.0311483172906957,0.0211697040898147,0.178897707696501,-0.00502948946155978,0.00215318360760796,-0.03956891850973,0.00953076344785275,0.273393487378502,0.00845163620949406,0.110970879866571,0.00088657448531387,-0.034515072970484,0.199627138388969,0.076499941764698,-0.224711423915255,-0.389104704257574,0.00945134347954055,-0.303033132213519,0.332683963128671,0.035676164470975,-0.00499895564763171,-0.0518552216136132,0.00261974968282972,0.00971793886187708,0.016375858767156,0.0285375620641541,0.0657923307731659,0.230190765369129,0.0387110815180418,0.00196171914439871,-0.0307977786271147,-0.0106504142486876,0.16903073276181,0.18787942158191,0.00111482726064398,-0.0134397078668296,0.0642973409995044,0.210742038181275,-0.123210504525533,0.263056347431785,0.0697335506343066,0.417816612619927,0.347389201549375,-0.079652547688368,-0.501137417194615,0.00746029638977081,0.00186065034315772,0.00381204608023384,0.0173712499305991,0.210754033253554,-0.186845807850672,0.016575322236249,-0.0073563123263706,-0.00410396461022413,0.022744685218329,0.0775326399807363,-0.0207709016164038,0.00258574763212121,0.54662374643122,0.0157446312810564,-0.0224213822037493,0.00597315601676949,0.0843693792079805,0.057329394304454,0.00397980181533651,0.0235785463374379,0.0149324236076523,0.0233886668991323,0.0636909201914003,-0.00615078474862505,0.0787040913795619,0.03402659990654,0.0130982884632946,0.00117186513413692,0.0154908381393937,0.0263466838053367,-0.00369814034159806,0.215641000828999,-0.058029634049956,-0.0423331781920527,-0.0203620284885463,0.101120998521002,0.0820499722376298,-0.0780434803413868,0.189391479925238,0.00610733130906854,-0.00172348548294975,0.0463822173189535,-0.0427004549356993,-0.00982087599340149,-0.0226931398263537,-0.017659385703192,0.661398500154624,-0.00333838886205056,0.0108935538775815,-0.0350436644740048,-0.0782956267579835,-0.00296724083943341,0.00284900098376553,-0.00588625508068135,0.2674867858663,0.215928984888011,-0.0150989767794826,0.0125000789312253,0.0104401585912315,0.0292734927677702,-0.0185049551814949,-0.0669014640232874,0.00667467065611053,0.0171950538659555,0.00744325259331056,-0.0337134305886307,-0.0402012698165907,0.107785666748285,-0.00385056997036795,0.0207493530697854,-3.50327054529989,0.011924777164666,-0.0199536692985816,0.0367716389991224,0.0359214801343142,-0.0042698718251357,0.0266981591158195,-0.071713850704891,-0.000941149350084585,0.0184308990645733,-0.0244792793813444,0.00575253362536943,0.0708935779969034,0.0213505411374753,0.050099714999015,-0.0121509668086519,-0.00691574828998177,0.0183932058437,0.0160612157621012,0.00338602763445227,-0.0143962661530386,-0.0130755363916229,0.697599439914493,0.00380290674114569,0.019675514059235,0.00771184927941348,0.00345776337478434,-0.00389916254891992,0.0988997775916335,-0.0635184374490308,0.328071883689979,-0.00946272108355095,-0.872461319682172,0.0160034471330085,0.010111677568073,0.325738988076603,-0.01717553385352,-0.00120184254277656,0.0317108674031244,0.072492547356736,-0.0125084796238599,0.0150510981833983,0.0123916769445516,0.528723223777208,0.00464245555092833,0.0455676948310774,0.0036643610097761,0.00704514508857436,0.0102963494451529,-0.00599845650274573,-0.0160447964912568,0.0159174159671013,0.00736245246699334,0.0190293484497019,-0.010288537119065,0.0130181285199454,0.00863312305483558,0.0205277095702518,-0.00289217029666489,0.13585683896761,0.00823705782477292,0.032600492154769,-0.0205727416763681,0.00184222275420637,0.0349192319186069,0.189780363575062,-0.0187906382560404,-0.00431852895172234,0.128221742841996,0.0132995889752917,0.507498711732116,0.423359139496416,-0.0541764295965375,-0.00226444081299317,-0.0417358133970013,0.00207168872317456,-0.0112385203318743,0.147318710902342,0.0189226976850068,-0.356857048873886,0.110523659112421,0.462466038042281,-0.00489525063080414,-0.0197890208081422,0.410950114887647,-0.00259805126013375,0.54392074381884,-0.000308802558230155,0.00357790256298521,-0.000713941418322876,0.0391636083697946,0.0135185466403489,0.00402533802494919,-0.00661880260623124,0.0017707096949152,-0.00128252333762886,-0.00473674156624695,-0.0152190350660597,0.0185253804472401,-0.013446676787656,0.261003094952743,0.170813938054513,0.00372572017034633,-0.00259421206442047,0.0199876240156344,0.0253917431452523,-0.00234436920136092,0.105429078873442,-0.0115050093188618,-0.0968733896085684,-0.0211273054063198,0.015228664834208,0.0413694592899629,0.0247357891934675,-0.0267644633795362,0.0173373531824451,0.000269829527546672,-0.00680379813775118,0.0231508020170457,0.0445489412440554,0.016095900148888,0.10785881543879,0.00284396061109844,0.0104393843036426,-0.000192623663917271,0.00327716840029939,-0.0236045134116881,0.00304982929068887,0.617182003405636,0.0153301763798167,0.125527095288445,0.0192882144458752,0.00845610398797346,0.0067215428201845,-0.0164071672794123,0.00290506072211417,0.0194008187952839,0.0346162677092436,0.00383943822077111,0.00203669618373138,0.0448097244115893,0.0363295532776903,0.0277250686131311};

	//Beta.set(test);

	int sizeOfSample = Beta.getSize();


	vector<bsccs::real> independentNormal;  //Sampled independent normal values

	boost::normal_distribution<> nd(0.0, 1.0); // TODO Construct once

	boost::variate_generator<boost::mt19937&,
	                           boost::normal_distribution<> > var_nor(rng, nd); // TODO Construct once

	Eigen::VectorXf b = Eigen::VectorXf::Random(sizeOfSample);
	for (int i = 0; i < sizeOfSample; i++) {
		bsccs::real normalValue = var_nor();
		// NB: tuningParameter scales the VARIANCE
		b[i] = normalValue * std::sqrt(getTransformedTuningValue(tuningParameter)); // multiply by stdev
	}

#ifdef Debug_TRS
	cout << "Cholesky in Sampler " << endl;
	Eigen::MatrixXf CholeskyDecompL(sizeOfSample, sizeOfSample);
	CholeskyDecompL = choleskyEigen.matrixU();
	cout << CholeskyDecompL << endl;
#endif

	(choleskyEigen.matrixU()).solveInPlace(b);

	// TODO Check marginal variance on b[i]


	for (int i = 0; i < sizeOfSample; i++) {
		Beta.set(i, b[i] + Beta_Hat.get(i));
	}

	cout << "Beta current" << endl;
	Beta.logParameter();
	cout << "Beta storred" << endl;
	Beta.logStored();
	cout << "BetaHat current" << endl;
	Beta_Hat.logParameter();
	cout << "BetaHat storred" << endl;
	Beta_Hat.logStored();


}

bool IndependenceSampler::evaluateSample(Model& model, double tuningParameter, boost::mt19937& rng, CyclicCoordinateDescent & ccd){
	cout << "IndependenceSampler::evaluateSample" << endl;


	bool accept = MHstep.evaluate(model, model.getBeta(), model.getBeta_Hat(), model.getSigmaSquared(), ccd, rng, model.getHessian(), tuningParameter);


	return(accept);
}


}
